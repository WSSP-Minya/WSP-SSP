<!DOCTYPE html>
<html>


<!--Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³Ù‰ Ù„Ù„ØµÙØ­Ø©-->
<head>
    <title >RWater Quality Monitoring</title>
    <link rel="stylesheet" href="Water_Quality.css">

</head>



<body>
    <!-- Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©-->
<div class="username">
    <label for="username" class="dislabel" type="label">Email</label>
    <input id="username" value="" disabled> 
   
</div>
<div class="region">
    <label for="section" class="dislabel" type="label">Section</label>
    <input id="section" value="" disabled> 
   
</div>

<br>
<br>
    <h1>Raw Water Quality Monitoring</h1>




                    <!--Water qyality form-->
<form>
    <!--Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ©-->
    <div class="essdata">
    <label class="dat" for="date">Date</label>
    <input id="date" type="date" required>

    <label class="dat"for="branch">Branch</label>
    <select id="branch" type="select" required>                      
            <option value="" disabled selected>Select Branch</option> 
            <option value="Ø§Ù„Ø¹Ø¯ÙˆÙ‡">Ø§Ù„Ø¹Ø¯ÙˆÙ‡</option>
            <option value="Ù…ØºØ§ØºØ©">Ù…ØºØ§ØºØ©</option>
            <option value="Ø¨Ù†Ù‰ Ù…Ø²Ø§Ø±">Ø¨Ù†Ù‰ Ù…Ø²Ø§Ø±</option>
            <option value="Ù…Ø·Ø§Ù‰">Ù…Ø·Ø§Ù‰</option>
            <option value="Ø³Ù…Ø§Ù„ÙˆØ·">Ø³Ù…Ø§Ù„ÙˆØ·</option>
            <option value="Ø§Ù„Ù…Ù†ÙŠØ§">Ø§Ù„Ù…Ù†ÙŠØ§</option>
            <option value="Ø§Ø¨ÙˆÙ‚Ø±Ù‚Ø§Øµ">Ø§Ø¨ÙˆÙ‚Ø±Ù‚Ø§Øµ</option>
            <option value="Ù…Ù„ÙˆÙ‰">Ù…Ù„ÙˆÙ‰</option>
            <option value="Ø¯ÙŠØ±Ù…ÙˆØ§Ø³">Ø¯ÙŠØ±Ù…ÙˆØ§Ø³</option>
    </select>
        
    <label class="dat" for="station">Station</label>
    <select id="station" value="" type="select"><option>Select Staion</option></select> 

    <label class="dat" for="sample">Location</label>
    <input id="sample" value="Ø§Ù„Ù…Ø£Ø®Ø°" type="location" readonly>
    
    <input type="hidden" id="entry-id">


    
    </div>
    <hr>

  
       
        <input id="physical" type="radio" name="para" checked>
        <label for="physical" class="para-label" >Physical parameters</label>

        
        <input id="chemical" type="radio" name="para">
        <label for="chemical" class="para-label">Chemical parameters</label>

        <input id="biological" type="radio" name="para">
        <label for="biological" class="para-label">Biological parameters</label>
    
               <!--Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©-->

    <div class="contents">
        <div class="content" id="physical-content">

            <label for="turbidity">Turbidity NTU</label>
            <input id="turbidity" name="turbidity" type="number">
            
            <label for="pH">pH</label>
            <input id="pH" name="pH" type="number">

            <label for="temp">Temp <sup>o</sup>C</label>
            <input id="temp" name="temp" type="number">
       
                        <!--Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØ©-->
        </div>
        <div class="content" id="chemical-content">
          
            <label for="tds">TDS mg/l</label>
            <input id="tds" name="tds" type="number">

            <label for="ch">Chlorides mg/l</label>
            <input id="ch" name="ch" type="number">

            <label for="sulf">Sulfates mg/l</label>
            <input id="sulf" name="sulf" type="number">

            <label for="fe">Fe mg/l</label>
            <input id="fe" name="fe" type="number">

            <label for="mn">Mn mg/l</label>
            <input id="mn" name="mn" type="number">

            <label for="nh3">NH<sub>3</sub> mg/l</label>
            <input id="nh3" name="nh3" type="number">

         
            

   
            <label for="no2">NO<sub>2</sub> mg/l</label>
            <input id="no2" name="no2" type="number">

            <label for="no3">NO<sub>3</sub> mg/l</label>
            <input id="no3" name="no3" type="number">
                    
            <label for="do">DO mg/l</label>
            <input id="do" name="do" type="number">

            <label for="cod">COD mg/l</label>
            <input id="cod" name="cod" type="number">

            <label for="bod">BOD mg/l</label>
            <input id="bod" name="bod" type="number">

            <label for="og">Oil & Grease mg/l</label>
            <input id="og" name="og" type="number">

            
        </div>

            <!--Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠÙˆÙ„ÙˆØ¬ÙŠØ© ÙˆØ§Ù„Ù…ÙŠÙƒØ±ÙˆØ¨ÙŠÙˆÙ„ÙˆØ¬ÙŠØ©-->
        <div class="content" id="biological-content">
            <label for="tc">Total Coliform C.U.F/100 ml</label>
            <input id="tc" name="tc" type="number">

            <label for="ta">Total Algae Colony/100 ml</label>
            <input id="ta" name="ta" type="number">

        </div>
    </div> 
    <br>
    <br>
    

    <div class="buttons">
        <button class="button-content">Submit</button>
        
        <button class="button-content">Update</button>
        
        <button class="button-content">Delete</button>
        
    </div>
    <br><br><br><br><br><br><br>
    <div>
        <button onclick="printTable()" class="output">
            <img src="https://static.vecteezy.com/system/resources/previews/006/693/009/non_2x/printer-icon-template-black-color-editable-printer-icon-symbol-flat-illustration-for-graphic-and-web-design-free-vector.jpg" alt="print">
        </button>
    
        <button onclick="exportTableToExcel('waterqualitytable', 'water_quality_data')" class="output">
            <img src="https://static.vecteezy.com/system/resources/previews/017/396/828/non_2x/microsoft-excel-mobile-apps-logo-free-png.png" alt="export">
        </button>
    </div>
    
    <table id = "waterqualitytable" class="table-data">
        <thead class="thead">
            <tr>
              
              <th>Date</th>
              <th>Branch</th> <!--ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø·Ø±-->
              <th>Station</th> <!--Ø§Ø¶Ø§ÙØ© Ø³Ø·Ø±-->
              <th>location</th>
              <th>Turbidity</th>
              <th>pH</th>
              <th>Temp</th>
              <th>TDS</th>
              <th>Chlorides</th>
              <th>Sulfates</th>
              <th>Fe</th>
              <th>Mn</th>
              <th>NH<sub>3</sub></th>
              <th>NO<sub>2</sub></th>
              <th>NO<sub>3</sub></th>
              <th>DO</th>
              <th>COD</th>
              <th>BOD</th>
              <th>Oil&Grease</th>
              <th>Total Coliform</th>
              <th>Total Algae</th>
              
            </tr>
        </thead>
        <tbody>
            <tr>
              <td></td> 
            </tr>
        </tbody>
       
    </table>
   

</form>
</body> 
</html>
<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbxRVygUFbR_6FFIap1JKLs2Nux0xXAeMBI4stS8zLt6pJTTB6YLoXQdAfxtUvmTkr41Uw/exec";
    
// ØªØ¹Ø±ÙŠÙ Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
let department = "";

// ÙŠØªÙ… ØªÙ†ÙÙŠØ° Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
window.onload = () => {
  // Ø¬Ù„Ø¨ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆØ§Ù„Ù‚Ø³Ù… Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø© (sessionStorage)
  const email = sessionStorage.getItem("email");
  department = sessionStorage.getItem("department");
console.log("Email:", email, "Password:", password, "Department:", department);
 


  // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù€ select Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø­Ø·Ø© ÙˆØ§Ù„ÙØ±Ø¹
  const stationSelect = document.getElementById("station");
  const branchSelect = document.getElementById("branch");

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ØŒ Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø© ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  if (!email || !department) {
    alert("ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    window.location = "login.html";
    return;
  }

  // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆØ§Ù„Ù‚Ø³Ù… ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡Ù…Ø§
  document.getElementById("username").value = email;
  document.getElementById("section").value = department;

  // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ù‚Ø³Ù… WSP
  if (department !== "WSP") {
    // ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙØ±Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ø§Ù„Ù‚Ø³Ù… ÙˆØªØ¹Ø·ÙŠÙ„ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© ØªØºÙŠÙŠØ±Ù‡
    branchSelect.value = department;
    branchSelect.disabled = true;

    // ğŸ”¹ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø¨Ø¯ÙˆÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±
        loadStations(department);
      } else {
        branchSelect.disabled = false;
    
        branchSelect.addEventListener("change", () => {
          if (branchSelect.value) {
            loadStations(branchSelect.value);
          }
        });
      }
    
      // ğŸ”¹ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ fetchData Ø¨Ø¯ÙˆÙ† ØªÙ…Ø±ÙŠØ± password
      fetchData(email, department);
    };
    
    // ğŸ”¹ Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø¨Ø´ÙƒÙ„ Ù…ÙˆØ­Ø¯
    function loadStations(branch) {
      const stationSelect = document.getElementById("station");
      stationSelect.innerHTML = '<option disabled selected>Loading stations...</option>';
    
      fetch(`${scriptURL}?action=getStations&branch=${encodeURIComponent(branch)}`)
        .then(res => res.json())
        .then(data => {
          if (data.status === "success") {
            stationSelect.innerHTML = '<option disabled selected>Select Station</option>';
            data.stations.forEach(st => {
              const opt = document.createElement("option");
              opt.value = st;
              opt.textContent = st;
              stationSelect.appendChild(opt);
            });
          } else {
            stationSelect.innerHTML = '<option disabled>Not found</option>';
          }
        })
        .catch(() => {
          stationSelect.innerHTML = '<option disabled>Error</option>';
        });
    }
    
    // ğŸ”¹ ØªØ¹Ø¯ÙŠÙ„ fetchData Ù„ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† password
    function fetchData(email, department) {
      fetch(`${scriptURL}?action=getData&email=${encodeURIComponent(email)}&department=${encodeURIComponent(department)}`)
        .then(response => response.json())
        .then(data => {
          if (!data || !data.water_data) {
            alert("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            return;
          }
    
          const rows = data.water_data;
          const tbody = document.querySelector("table.table-data tbody");
          tbody.innerHTML = "";
    
          const desiredColumnIndexes = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21];
    
          rows.slice(1).forEach(row => {
            const rowBranch = row[2];
    
            // ğŸ”¹ ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØµÙÙˆÙ ØºÙŠØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù‚Ø³Ù… Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† WSP
            if (department !== "WSP" && rowBranch !== department) return;
    
            const tr = document.createElement("tr");
    
            row.forEach((cell,index) => {
              if (desiredColumnIndexes.includes(index)) {
                const td = document.createElement("td");
    
                if (index === 1) {
                  const d = new Date(cell);
                  td.textContent = !isNaN(d.getTime())
                    ? `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`
                    : cell ?? "";
                } else {
                  td.textContent = cell ?? "";
                }
    
                tr.appendChild(td);
              }
            });
    
            tr.addEventListener("click", () => {
              clearRowHighlight();
              tr.classList.add("selected-row");
              fillFormWithRow(row);
            });
    
            tbody.appendChild(tr);
          });
    
          if (!tbody.hasChildNodes()) {
            const tr = document.createElement("tr");
            tr.innerHTML = `<td colspan="21" style="text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td>`;
            tbody.appendChild(tr);
          }
    
        })
        .catch(error => {
          console.error("Fetch Error:", error);
          alert("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        });
    }

function formatDateForInput(dateValue) {
  try {
    const d = new Date(dateValue);
    if (isNaN(d.getTime())) return "";

    // Ø§Ø³ØªØ®Ø¯Ø§Ù… toLocaleDateString Ù„Ø¶Ù…Ø§Ù† ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¥Ù„Ù‰ ØªÙˆÙ‚ÙŠØª Ù…ØµØ±
    const [day, month, year] = d
      .toLocaleDateString("en-GB", { timeZone: "Africa/Cairo" })
      .split("/");

    return `${year}-${month.padStart(2, "0")}-${day.padStart(2, "0")}`;
  } catch (error) {
    console.error("Invalid date for input formatting:", error);
    return "";
  }
}

function fillFormWithRow(row) {
  console.log("Row data:", row); // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ù„ØµØ© Ù…Ù† Ø§Ù„ØµÙ

  const formattedDate = formatDateForInput(row[1]); // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
  document.getElementById("date").value = formattedDate; // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚Ù„ Ø¨Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ù†Ø³Ù‚

  document.getElementById("entry-id").value = row[0]; // ØªØ¹Ø¨Ø¦Ø© ID
    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ÙØ±Ø¹
  document.getElementById("branch").value = row[2];

  // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… WSPØŒ Ù†Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ù…Ø®ØªØ§Ø± Ù…Ù† Ø§Ù„ØµÙ
  if (department === "WSP") {
    // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„ÙØ±Ø¹
    fetch(`${scriptURL}?action=getStations&branch=${encodeURIComponent(row[2])}`)
      .then(response => response.json())
      .then(data => {
        const stationSelect = document.getElementById("station");
        stationSelect.innerHTML = '<option value="" disabled selected>Select Station</option>';

        if (data.status === "success") {
          data.stations.forEach(station => {
            const option = document.createElement("option");
            option.value = station;
            option.textContent = station;
            stationSelect.appendChild(option);
          });

          // Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø·Ø§ØªØŒ Ù†Ø¶Ø¨Ø· Ø§Ù„Ù…Ø­Ø·Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù‚ÙŠÙ…Ø© Ø§Ù„ØµÙ
          stationSelect.value = row[3];
        } else {
          stationSelect.innerHTML = '<option value="" disabled selected>Not found</option>';
        }
      })
      .catch(error => {
        console.error("Error fetching stations:", error);
        document.getElementById("station").innerHTML = '<option value="" disabled selected>Connection Error</option>';
      });
  } else {
    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† WSPØŒ ÙÙ‚Ø· Ø¹ÙŠÙ† Ø§Ù„Ù…Ø­Ø·Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
    document.getElementById("station").value = row[3];
  }

  document.getElementById("branch").value = row[2]; // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ÙØ±Ø¹
  document.getElementById("station").value = row[3]; // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ø­Ø·Ø©
  document.getElementById("sample").value = row[4]; // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹

  // ØªØ¹Ø¨Ø¦Ø© Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„
  document.getElementById("turbidity").value = row[5];
  document.getElementById("pH").value = row[6];
  document.getElementById("temp").value = row[7];
  document.getElementById("tds").value = row[8];
  document.getElementById("ch").value = row[9];
  document.getElementById("sulf").value = row[10];
  document.getElementById("fe").value = row[11];
  document.getElementById("mn").value = row[12];
  document.getElementById("nh3").value = row[13];
  document.getElementById("no2").value = row[14];
  document.getElementById("no3").value = row[15];
  document.getElementById("do").value = row[16];
  document.getElementById("cod").value = row[17];
  document.getElementById("bod").value = row[18];
  document.getElementById("og").value = row[19];
  document.getElementById("tc").value = row[20];
  document.getElementById("ta").value = row[21];
}

function clearRowHighlight() {
  document.querySelectorAll("table.table-data tr").forEach(row => {
    row.classList.remove("selected-row");
  });
}

// Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙ ÙˆØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
document.querySelectorAll("table.table-data tr").forEach(row => {
  row.addEventListener("click", function() {
    console.log("Row selected:", row);
    clearRowHighlight(); // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ…ÙŠÙŠØ² Ø¹Ù† Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø£Ø®Ø±Ù‰
    row.classList.add("selected-row"); // ØªÙ…ÙŠÙŠØ² Ø§Ù„ØµÙ Ø§Ù„Ø­Ø§Ù„ÙŠ
    const rowData = Array.from(row.children).map(td => td.textContent); // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø®Ù„Ø§ÙŠØ§ Ø§Ù„ØµÙ
    fillFormWithRow(rowData); // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙ
  });
});
document.querySelectorAll(".button-content")[0].addEventListener("click", function (e) {
  e.preventDefault();
  sendData("add");
});

document.querySelectorAll(".button-content")[1].addEventListener("click", function (e) {
  e.preventDefault();
  sendData("update");
});

document.querySelectorAll(".button-content")[2].addEventListener("click", function (e) {
  e.preventDefault();
  sendData("delete");
});

    
function sendData(action) {
  const email = sessionStorage.getItem("email");
  const department = sessionStorage.getItem("department");

  if ((action === "update" || action === "delete") && !document.getElementById("entry-id").value) {
    alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø£Ùˆ Ø§Ù„Ø­Ø°Ù.");
    return;
  }

  const formData = new URLSearchParams();
  formData.append("action", action);
  formData.append("email", email);
  formData.append("department", department);
  formData.append("id", document.getElementById("entry-id").value);
  formData.append("date", document.getElementById("date").value);
  formData.append("branch", document.getElementById("branch").value);
  formData.append("station", document.getElementById("station").value);
  formData.append("location", document.getElementById("sample").value);
  formData.append("turbidity", document.getElementById("turbidity").value);
  formData.append("ph", document.getElementById("pH").value);
  formData.append("temp", document.getElementById("temp").value);
  formData.append("tds", document.getElementById("tds").value);
  formData.append("chlorides", document.getElementById("ch").value);
  formData.append("sulfates", document.getElementById("sulf").value);
  formData.append("fe", document.getElementById("fe").value);
  formData.append("mn", document.getElementById("mn").value);
  formData.append("nh3", document.getElementById("nh3").value);
  formData.append("no2", document.getElementById("no2").value);
  formData.append("no3", document.getElementById("no3").value);
  formData.append("do", document.getElementById("do").value);
  formData.append("cod", document.getElementById("cod").value);
  formData.append("bod", document.getElementById("bod").value);
  formData.append("og", document.getElementById("og").value);
  formData.append("tc", document.getElementById("tc").value);
  formData.append("ta", document.getElementById("ta").value);

  fetch(scriptURL, {
    method: "POST",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded"
    },
    body: formData.toString()
  })
    .then(response => response.text())
    .then(result => {
      alert(`ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© ${action === 'add' ? 'Ø§Ù„Ø¥Ø¶Ø§ÙØ©' : action === 'update' ? 'Ø§Ù„ØªØ­Ø¯ÙŠØ«' : 'Ø§Ù„Ø­Ø°Ù'} Ø¨Ù†Ø¬Ø§Ø­.`);
      clearForm();
      fetchData(email, department);
    })
    .catch(error => {
      console.error("Ø®Ø·Ø£:", error);
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.");
    });
}

function clearForm() {
  document.querySelector("form").reset();
  document.getElementById("entry-id").value = "";
  clearRowHighlight();
  if (department !== "WSP") {
          // ØªØ­Ø¯ÙŠØ¯ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù€ select ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø³Ù…
          document.getElementById("branch").value = department;
          document.getElementById("branch").disabled = true;
          document.getElementById("station").innerHTML = '<option value="" disabled selected>Select Station</option>';
  }
  
}






    
function printTable() {
  const table = document.getElementById("waterqualitytable").outerHTML;
  const style = `
    <style>
      table { border-collapse: collapse; width: 100%; direction: ltr; }
      th, td { border: 1px solid #000; padding: 8px; text-align: center; }
    </style>
  `;
  const win = window.open('', '', 'height=700,width=900');
  win.document.write('<html><head><title>Raw Water Quality Monitoring</title>');
  win.document.write(style);
  win.document.write('</head><body>');
  win.document.write(table);
  win.document.write('</body></html>');
  win.document.close();
  win.print();
}
function exportTableToExcel(waterqualitytable, filename = '') {
  const table = document.getElementById(waterqualitytable);
  const dataType = 'application/vnd.ms-excel';
  const tableHTML = table.outerHTML.replace(/ /g, '%20');

  const link = document.createElement("a");
  document.body.appendChild(link);

  filename = filename ? filename + '.xls' : 'excel_data.xls';
  link.href = 'data:' + dataType + ', ' + tableHTML;
  link.download = filename;
  link.click();
  document.body.removeChild(link);
}


</script>


























































